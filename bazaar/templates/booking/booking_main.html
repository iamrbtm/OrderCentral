<!--
=========================================================
* Template for MasterList
=========================================================
Date: 1-12-23
Author:Jeremy Guill
Purpose:To provide one place for bookings of bazaars, flea markets, etc

Available Blocks
* title
* page_title
* stylesheets
* notifications
* main_content
* javascripts
=========================================================
-->
{% extends "base/base.html" %}

{% block title %}
    Booking
{% endblock title %}

{% block page_title %}
    <span class="text-primary text-capitalize">{{ record.event_name }} Booking</span>
{% endblock page_title %}

{% block stylesheets %}
    <script
            src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.13/css/dataTables.bootstrap.min.css">

    <script type="text/javascript">
        $(document).ready(function () {
            $('#documentlist').DataTable({
                "fixedHeader": true,
                "bPaginate": true,
                "bInfo": true,
                "orderMulti": true,
                "bAutoWidth": false,
                "colReorder": true,
                "responsive": true,
                "searchable": true,
            });
        });
    </script>
{% endblock stylesheets %}

{% block notifications %}
{% endblock notifications %}

{% block main_content %}
    <section class="section">
        <div class="m-4">
            <ul class="nav nav-tabs" id="myTab">
                <li class="nav-item">
                    <a href="#event-info" class="nav-link active" data-bs-toggle="pill">Event Info</a>
                </li>
                <li class="nav-item">
                    <a href="#info" class="nav-link" data-bs-toggle="pill">Info</a>
                </li>
                <li class="nav-item">
                    <a href="#key-dates" class="nav-link" data-bs-toggle="tab">Key Dates</a>
                </li>
                <li class="nav-item">
                    <a href="#checklists" class="nav-link" data-bs-toggle="tab">Checklists</a>
                </li>
                <li class="nav-item">
                    <a href="#documents" class="nav-link" data-bs-toggle="tab">Documents</a>
                </li>
                <li class="nav-item">
                    <a href="#notes" class="nav-link" data-bs-toggle="tab">Notes</a>
                </li>
                <li class="nav-item">
                    <a href="#breakdown" class="nav-link" data-bs-toggle="tab">Post Event Breakdown</a>
                </li>
            </ul><!--END Tab Creation-->

            <div class="tab-content">
                <div class="tab-pane fade show active" id="event-info">
                    <form class="form" method="post"
                          action="{{ url_for('booking.booking_edit', eventid=record.id, bookingid=booking.id ) }}">
                        <div class="card" style="width: 100%; height: 100vh;">
                            <div class="card-body">
                                <div class="vpe-event-head">{{ record.event_name }} <a
                                        href="{{ url_for('masterlist.edit_single', id=record.id) }}"> <i
                                        class="bi bi-pencil-square"></i></a>
                                </div>
                                <h5 class="text-warning text-decoration-underline">Venue &
                                    Promoter</h5>
                                <div class="vpe-venue-head">{{ record.venue.name }} </div>
                                <div class="vpe-body">
                                    {% if record.venue.address != None %}
                                        {{ record.venue.address }} {{ record.venue.city }}, {{ record.venue.state }}
                                        {{ record.venue.zipcode }}<br>
                                    {% endif %}
                                    {% if record.venue.phone != None %}
                                        {{ record.venue.phone }}
                                    {% endif %}
                                    {% if record.venue.website != None %}
                                        | {{ record.venue.website }}
                                    {% endif %}
                                </div>

                                <div class="vpe-venue-head">{{ record.promoter.name }}</div>
                                <div class="vpe-body">
                                    {% if record.promoter.address != None %}
                                        {{ record.promoter.address }} {{ record.promoter.city }},
                                        {{ record.promoter.state }}
                                        {{ record.promoter.zipcode }}<br>
                                    {% endif %}
                                    {% if record.promoter.phone != None %}
                                        {{ record.promoter.phone }}
                                    {% endif %}
                                    {% if record.promoter.website != None %}
                                        | {{ record.promoter.website }}
                                    {% endif %}
                                </div>

                                <div class="vpe-venue-head">People</div>
                                <div class="vpe-body">
                                    {% for person in persons %}
                                        {{ person.name }}
                                        {% if person.email != None %}
                                            -<a class="vpe-body"
                                                href="mailto:{{ person.email }}">{{ person.email }}</a>
                                        {% endif %}
                                        {% if person.phone != None %}
                                            -<a class="vpe-body"
                                                href="tel:{{ person.phone }}">{{ person.phone }}</a>
                                        {% endif %}
                                        <br>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </form>
                </div><!-- END Event Info -->

                <div class="tab-pane fade" id="info">
                    <form class="form" method="post"
                          action="{{ url_for('booking.booking_edit', eventid=record.id, bookingid=booking.id ) }}">
                        <div class="card" style="width: 100%; height: 100vh;">
                            <div class="d-flex mb-3">
                                <div class="me-auto">
                                    <div class="vpe-venue-head p-3">Information</div>
                                </div>
                                <div class="p-3">
                                    <button type="submit" class="btn btn-primary">
                                        Save
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="vpe-body row">
                                    <div class="col-6">
                                        <div class="input-group flex-nowrap">
                                            <label class="col-sm-2 col-form-label" for="info_datestart">Start
                                                Date</label>
                                            <input
                                                    class="form-control"
                                                    type="date"
                                                    id="info_datestart"
                                                    name="info_datestart"
                                                    value="{{ booking.info_datestart }}">
                                        </div>
                                        <div class="input-group flex-nowrap">
                                            <label class="col-sm-2 col-form-label" for="info_dateend">End Date</label>
                                            <input
                                                    class="form-control"
                                                    type="date"
                                                    id="info_dateend"
                                                    name="info_dateend"
                                                    value="{{ booking.info_dateend }}">
                                        </div>

                                        <div class="input-group flex-nowrap">
                                            <label class="col-sm-2 col-form-label" for="info_loadindatetime">Load In
                                                Time</label>
                                            <input
                                                    class="form-control"
                                                    type="datetime-local"
                                                    id="info_loadindatetime"
                                                    name="info_loadindatetime"
                                                    value="{{ booking.info_loadindatetime }}">
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <div class="input-group flex-nowrap">
                                            <label class="col-sm-2 col-form-label" for="info_timestart">Start
                                                Time</label>
                                            <input
                                                    class="form-control"
                                                    type="time"
                                                    id="info_timestart"
                                                    name="info_timestart"
                                                    value="{{ booking.info_timestart }}">
                                        </div>
                                        <div class="input-group flex-nowrap">
                                            <label class="col-sm-2 col-form-label" for="info_timeend">End Time</label>
                                            <input
                                                    class="form-control"
                                                    type="time"
                                                    id="info_timeend"
                                                    name="info_timeend"
                                                    value="{{ booking.info_timeend }}">
                                        </div>
                                        <div class="input-group flex-nowrap">
                                            <label class="col-sm-2 col-form-label" for="info_loadoutdatetime">Load Out
                                                Time</label>
                                            <input
                                                    class="form-control"
                                                    type="datetime-local"
                                                    id="info_loadoutdatetime"
                                                    name="info_loadoutdatetime"
                                                    value="{{ booking.info_loadoutdatetime }}"
                                            >
                                        </div>
                                    </div>
                                </div>
                                <div class="vpe-body row">
                                    <h5>Location</h5>
                                    <div class="col-6">
                                        <div class="input-group flex-nowrap">
                                            <label class="col-sm-2 col-form-label" for="info_boothfee">Booth Fee</label>
                                            <input
                                                    class="form-control"
                                                    type="number"
                                                    min="0.01"
                                                    max="999.99"
                                                    step=".01"
                                                    id="info_boothfee"
                                                    name="info_boothfee"
                                                    value="{{ booking.info_boothfee }}"
                                            >
                                        </div>
                                        <div class="input-group flex-nowrap">
                                            <label class="col-sm-2 col-form-label" for="info_whatfeeincludes">What is
                                                Included</label>
                                            <input
                                                    class="form-control"
                                                    type="text"
                                                    id="info_whatfeeincludes"
                                                    name="info_whatfeeincludes"
                                                    value="{{ booking.info_whatfeeincludes }}"
                                            >
                                        </div>
                                        <div class="input-group flex-nowrap">
                                            <label class="col-sm-2 col-form-label" for="info_boothlocation">Booth
                                                Location</label>
                                            <input
                                                    class="form-control"
                                                    type="text"
                                                    id="info_boothlocation"
                                                    name="info_boothlocation"
                                                    value="{{ booking.info_boothlocation }}"
                                            >
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="input-group flex-nowrap">
                                            <label class="form-check-label" for="info_foodpurchase">Food Details</label>
                                            <input type="text"
                                                   class="form-control"
                                                   id="info_foodpurchase"
                                                   name="info_foodpurchase"
                                                   value="{{ booking.info_foodpurchase }}"
                                            >
                                        </div>
                                        <div class="input-group flex-nowrap">
                                            <label class="form-label" for="info_wifipassword">Wifi
                                                Password</label>
                                            <input type="text"
                                                   class="form-control"
                                                   id="info_wifipassword"
                                                   name="info_wifipassword"
                                                   value="{{ booking.info_wifipassword }}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div><!-- END Info Tab-->

                <div class="tab-pane fade" id="key-dates">
                    <form class="form" method="post"
                          action="{{ url_for('booking.booking_edit', eventid=record.id, bookingid=booking.id ) }}">
                        <div class="card" style="width: 100%; height: 100vh;">
                            <div class="d-flex mb-3">
                                <div class="me-auto">
                                    <div class="vpe-venue-head p-3">Key Dates</div>
                                </div>
                                <div class="p-3">
                                    <button type="submit" class="btn btn-primary">
                                        Save
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="vpe-body row">
                                    <div class="col-6" id="returningvendors">
                                        <h5>Returning Vendors</h5>
                                        <div>Application Opens <input type="date" class="form-control"
                                                                      name="kd_appopen_return"
                                                                      id="kd_appopen_return"
                                                                      value="{{ booking.kd_appopen_return }}">
                                        </div>
                                        <div>Application Deadline <input type="date" class="form-control"
                                                                         name="kd_appdeadline_return"
                                                                         id="kd_appdeadline_return"
                                                                         value="{{ booking.kd_appdeadline_return }}">
                                        </div>
                                    </div>
                                    <div class="col-6" id="newvendors">
                                        <h5>New Vendors</h5>
                                        <div>Application Opens <input type="date" class="form-control"
                                                                      name="kd_appopen_new"
                                                                      id="kd_appopen_new"
                                                                      value="{{ booking.kd_appopen_new }}">
                                        </div>
                                        <div>Application Deadline <input type="date" class="form-control"
                                                                         name="kd_appdeadline_new"
                                                                         id="kd_appdeadline_new"
                                                                         value="{{ booking.kd_appdeadline_new }}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div><!-- END Key Dates -->

                <div class="tab-pane fade" id="checklists">
                    <form class="form" method="post"
                          action="{{ url_for('booking.booking_edit', eventid=record.id, bookingid=booking.id ) }}">
                        <div class="card" style="width: 100%; height: 100vh;">
                            <div class="d-flex mb-3">
                                <div class="me-auto">
                                    <div class="vpe-venue-head p-3">Check Lists</div>
                                </div>
                                <div class="p-3">
                                    <button type="submit" class="btn btn-primary">
                                        Save
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="card-body row">
                                    <div class="col-6" id="overall">
                                        <h5>General</h5>
                                        <div class="form-check form-switch">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   role="switch"
                                                   id="cl_appsubmission"
                                                   name="cl_appsubmission"
                                                   {% if booking.cl_appsubmission %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="cl_appsubmission">Application
                                                Submitted</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   role="switch"
                                                   id="cl_appapproved"
                                                   name="cl_appapproved"
                                                   {% if booking.cl_appapproved %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="cl_appapproved">Application
                                                Approved</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   role="switch"
                                                   id="cl_feepaid"
                                                   name="cl_feepaid"
                                                   {% if booking.cl_feepaid %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="cl_feepaid">Fee Paid</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   role="switch"
                                                   id="cl_electrequest"
                                                   name="cl_electrequest"
                                                   {% if booking.cl_electrequest %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="cl_electrequest">Electricity
                                                Requested</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   role="switch"
                                                   id="cl_sendproductpic"
                                                   name="cl_sendproductpic"
                                                   {% if booking.cl_sendproductpic %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="cl_sendproductpic">Send Product
                                                Pictures to Director</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   role="switch"
                                                   id="cl_sendlogo"
                                                   name="cl_sendlogo"
                                                   {% if booking.cl_sendlogo %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="cl_sendlogo">Send Logo to
                                                Director</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   role="switch"
                                                   id="cl_wifiavailable"
                                                   name="cl_wifiavailable"
                                                   {% if booking.cl_wifiavailable %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="cl_wifiavailable">Is Wifi
                                                Available</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input type="checkbox"
                                                   class="form-check-input"
                                                   role="switch"
                                                   id="cl_foodavailable"
                                                   name="cl_foodavailable"
                                                   {% if booking.cl_foodavailable %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="cl_foodavailable">Is Food Available
                                                onsite</label>
                                        </div>
                                    </div>
                                    <div class="col-6" id="dayof">
                                        <h5>Day Of</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div><!-- END Checklists -->

                <div class="tab-pane fade" id="documents">
                    <div class="card" style="width: 100%; height: 100vh;">
                        <div class="d-flex mb-3">
                            <div class="me-auto">
                                <div class="vpe-venue-head p-3">Documents</div>
                            </div>
                            <div class="p-3">
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                        data-bs-target="#add_doc">
                                    Add Document
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <table id="documentlist"
                                   class="table table-striped table-responsive table-borderless">
                                <thead>
                                <tr>
                                    <td>Filename</td>
                                    <th>File Type</th>
                                    <th>Size</th>
                                    <th>Upload Date/Time</th>
                                    <th></th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for key, value in files.items() %}
                                    <tr>
                                        <td>
                                            {% if value['filetype'] == ".pdf" %}
                                                <i class="bi bi-file-earmark-pdf-fill"></i>
                                            {% elif value['filetype'] == ".txt" %}
                                                <i class="bi bi-file-text-fill"></i>
                                            {% elif value['filetype'] == ".csv" %}
                                                <i class="bi bi-filetype-csv"></i>
                                            {% elif value['filetype'] == ".docx" %}
                                                <i class="bi bi-file-earmark-word-fill"></i>
                                            {% elif value['filetype'] == ".doc" %}
                                                <i class="bi bi-file-earmark-word-fill"></i>
                                            {% elif value['filetype'] == ".xlsx" %}
                                                <i class="bi bi-file-earmark-excel-fill"></i>
                                            {% else %}
                                                <i class="bi bi-file-image"></i>
                                            {% endif %}
                                            {{ value['file'] }}</td>
                                        <td>{{ value['filetype'] }}</td>
                                        <td>{{ value['size'] }}</td>
                                        <td>{{ value['created'] }}</td>
                                        <td><a href="{{ value['editlink'] }}"><i
                                                class="bi bi-eye-fill"></i></a>
                                        </td>
                                        <td><a href="{{ value['deletelink'] }}"><i
                                                class="bi bi-x-circle-fill"></i></a>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div><!-- END Documents -->

                <div class="tab-pane fade" id="notes">
                    <div class="card" style="width: 100%; height: 100vh;">
                        <div class="card-body">
                            <h5 class="card-title">Notes</h5>
                            <div class="filter px-3">
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                        data-bs-target="#addnote">
                                    Add A Note
                                </button>
                            </div>
                            <div>
                                <table class="table">
                                    <thead>
                                    <tr>
                                        <th>Note</th>
                                        <th class="text-end">Date Stamp</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for note in notes %}
                                        <tr>
                                            <td class="text-start text-uppercase">{{ note.note }}</td>
                                            <td class="text-end">{{ note.date_created |datetimeformat('%x %X') }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div><!-- END Notes -->

                <div class="tab-pane fade" id="breakdown">
                    <div class="card" style="width: 100%; height: 100vh;">
                        <div class="card-body">
                            <h5 class="card-title">Post Event Breakdown</h5>
                        </div>
                    </div>
                </div><!-- END Post Event Breakdown -->
            </div>
        </div>
    </section>

    <!-- Add Document Modal -->
    <div class="modal fade" id="add_doc" tabindex="-1" aria-labelledby="add_docLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="add_docLabel">Add Document to {{ record.event_name.title() }}
                        Booking</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form class="form" method="post" action="{{ url_for('booking.file_add', id=record.id) }}"
                      enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="input-group flex-nowrap">
                            <label for="file" class="form-label">Select File</label>
                            <input class="form-control form-control-lg" name="file" id="file" type="file">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Upload</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Note Modal -->
    <div class="modal fade" id="addnote" tabindex="-1" aria-labelledby="addnoteLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addnoteLabel">Add a note to {{ record.promoter.name }}</h5>
                </div>
                <form action="{{ url_for('masterlist.note_add', recordid=record.id) }}" method="post">
                    <div class="modal-body">
                        <div class="input-group flex-nowrap">
                            <label class="form-label" , for="note">Note</label>
                            <textarea class="form-control" cols="10" id="note" name="note"></textarea>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Add Person</button>
                    </div>
                </form>
            </div>
        </div>
    </div><!-- END Add Note modal-->
{% endblock main_content %}

{% block javascripts %}
{% endblock javascripts %}